pipeline{
     agent any
     tools{
         maven 'Maven'
         jdk 'jdk'

          }
   stages {
       stage('Git checkout')
       {
            steps{
                 git branch: 'master', url: 'https://github.com/sreelakshmi665/Trailtera.git'
            }
       }
      stage("validate"){
          steps{
              bat 'mvn -f codingChallenge -B -DskipTests clean validate'
          }
      }
       stage("compile"){
          steps{
              bat 'mvn  -f codingChallenge compile'
          }
      }
         stage('sonar analysis'){
            steps{
                script{
                
                withSonarQubeEnv('sonar-server'){
                    withMaven(maven:'Maven'){
                        bat 'mvn -f codingChallenge sonar:sonar'
                    }
                }
                }
            }

        }
        stage("Quality gate") {
            steps {
                script{
                waitForQualityGate abortPipeline: true
                }
            }
        }
             
      stage("package"){
          steps{
               bat 'mvn -f codingChallenge  -B -DskipTests package -Dbuild.number=-${BUILD_NUMBER}'
          }
      }
        
   stage('Collect-Artifactory')
    {
      steps{
         script{
          
              archiveArtifacts artifacts:'codingChallenge/target/CodingChallenge-0.0.1-SNAPSHOT-Dbuild.number.jar',followSymlinks:false
          }
      }
    }   
    stage('Deploy-To-Artifactory')
    {
      steps{
         script{
        rtUpload(
          serverId:'artifactory-server',
          spec: '''{
          "files": [
            {
              "pattern": "codingChallenge/target/CodingChallenge-0.0.1-SNAPSHOT-Dbuild.number.jar",
              "target": "art-doc-dev-loc"
            }
         ]
    }''',
          
)
          }
  }
}   
            
   }
}
